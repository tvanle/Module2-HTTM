# BÃO CÃO THIáº¾T Káº¾ Há»† THá»NG CHATBOT TÆ¯ Váº¤N THÃ”NG TIN TRÆ¯á»œNG PTIT

## NhÃ³m thá»±c hiá»‡n
1. **Nguyá»…n Thá»‹ Trang** - MÃ£ SV: 20210001 - Module Quáº£n lÃ½ ngÆ°á»i dÃ¹ng vÃ  xÃ¡c thá»±c
2. **LÃª VÄƒn Trá»ng** - MÃ£ SV: 20210002 - Module Xá»­ lÃ½ ngÃ´n ngá»¯ tá»± nhiÃªn (NLP) vÃ  tráº£ lá»i
3. **Pháº¡m VÄƒn ThuÃ¢n** - MÃ£ SV: 20210003 - Module Quáº£n lÃ½ cÆ¡ sá»Ÿ tri thá»©c vÃ  dá»¯ liá»‡u

---

# PHáº¦N 1: THIáº¾T Káº¾ KIáº¾N TRÃšC Há»† THá»NG (CHUNG)

## 1.1 Tá»•ng quan há»‡ thá»‘ng

Há»‡ thá»‘ng thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­ Ä‘Æ°á»£c xÃ¢y dá»±ng theo kiáº¿n trÃºc Client-Server 3 táº§ng (3-tier architecture):

- **Táº§ng Presentation (Client)**: Giao diá»‡n ngÆ°á»i dÃ¹ng, xÃ¢y dá»±ng báº±ng React/Vue.js
- **Táº§ng Business Logic (Server)**: Xá»­ lÃ½ nghiá»‡p vá»¥, xÃ¢y dá»±ng báº±ng Node.js/Express hoáº·c Java Spring Boot
- **Táº§ng Data**: CÆ¡ sá»Ÿ dá»¯ liá»‡u MySQL/PostgreSQL

## 1.2 SÆ¡ Ä‘á»“ kiáº¿n trÃºc tá»•ng quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CLIENT LAYER                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Web    â”‚  â”‚  Mobile  â”‚  â”‚  Admin   â”‚  â”‚   API    â”‚   â”‚
â”‚  â”‚   App    â”‚  â”‚   App    â”‚  â”‚  Panel   â”‚  â”‚  Client  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Load Balancer â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SERVER LAYER                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  API Gateway                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                             â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Auth    â”‚  â”‚  User    â”‚  â”‚ Product  â”‚  â”‚  Order   â”‚  â”‚
â”‚  â”‚ Service  â”‚  â”‚ Service  â”‚  â”‚ Service  â”‚  â”‚ Service  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATA LAYER                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  User    â”‚  â”‚ Product  â”‚  â”‚  Order   â”‚  â”‚  Cache   â”‚  â”‚
â”‚  â”‚    DB    â”‚  â”‚    DB    â”‚  â”‚    DB    â”‚  â”‚  (Redis) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 1.3 CÃ´ng nghá»‡ sá»­ dá»¥ng

### Frontend (Client)
- Framework: React.js / Vue.js
- State Management: Redux / Vuex
- UI Library: Material-UI / Ant Design
- HTTP Client: Axios

### Backend (Server)
- Platform: Node.js vá»›i Express.js
- Authentication: JWT (JSON Web Token)
- ORM: Sequelize / TypeORM
- API Documentation: Swagger

### Database
- Primary DB: MySQL / PostgreSQL
- Cache: Redis
- File Storage: AWS S3 / Local Storage

## 1.4 PhÃ¢n chia module

| Module | NgÆ°á»i phá»¥ trÃ¡ch | Chá»©c nÄƒng chÃ­nh |
|--------|----------------|-----------------|
| Quáº£n lÃ½ ngÆ°á»i dÃ¹ng | Nguyá»…n Thá»‹ Trang | ÄÄƒng kÃ½, Ä‘Äƒng nháº­p, quáº£n lÃ½ profile, phÃ¢n quyá»n |
| Quáº£n lÃ½ sáº£n pháº©m | LÃª VÄƒn Trá»ng | CRUD sáº£n pháº©m, danh má»¥c, tÃ¬m kiáº¿m, lá»c |
| Quáº£n lÃ½ Ä‘Æ¡n hÃ ng | Pháº¡m VÄƒn ThuÃ¢n | Giá» hÃ ng, Ä‘áº·t hÃ ng, thanh toÃ¡n, theo dÃµi Ä‘Æ¡n |

---

# PHáº¦N 2: THIáº¾T Káº¾ CHI TIáº¾T

## 2.1 THIáº¾T Káº¾ CHI TIáº¾T - NGUYá»„N THá»Š TRANG (MÃƒ SV: 20210001)
### Module: Quáº£n lÃ½ ngÆ°á»i dÃ¹ng

### 2.1.1 Thiáº¿t káº¿ CSDL

#### Báº£ng Users
```sql
CREATE TABLE users (
    user_id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    full_name VARCHAR(100),
    phone VARCHAR(20),
    address TEXT,
    role_id INT,
    status ENUM('active', 'inactive', 'banned') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (role_id) REFERENCES roles(role_id)
);
```

#### Báº£ng Roles
```sql
CREATE TABLE roles (
    role_id INT PRIMARY KEY AUTO_INCREMENT,
    role_name VARCHAR(50) UNIQUE NOT NULL,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### Báº£ng Permissions
```sql
CREATE TABLE permissions (
    permission_id INT PRIMARY KEY AUTO_INCREMENT,
    permission_name VARCHAR(100) UNIQUE NOT NULL,
    resource VARCHAR(50),
    action VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### Báº£ng Role_Permissions
```sql
CREATE TABLE role_permissions (
    role_id INT,
    permission_id INT,
    PRIMARY KEY (role_id, permission_id),
    FOREIGN KEY (role_id) REFERENCES roles(role_id),
    FOREIGN KEY (permission_id) REFERENCES permissions(permission_id)
);
```

### 2.1.2 Thiáº¿t káº¿ lá»›p thá»±c thá»ƒ

```java
// Entity: User
public class User {
    private int userId;
    private String username;
    private String email;
    private String passwordHash;
    private String fullName;
    private String phone;
    private String address;
    private Role role;
    private UserStatus status;
    private Date createdAt;
    private Date updatedAt;

    // Constructors, getters, setters
}

// Entity: Role
public class Role {
    private int roleId;
    private String roleName;
    private String description;
    private List<Permission> permissions;
    private Date createdAt;

    // Constructors, getters, setters
}

// Entity: Permission
public class Permission {
    private int permissionId;
    private String permissionName;
    private String resource;
    private String action;
    private Date createdAt;

    // Constructors, getters, setters
}

// Enum: UserStatus
public enum UserStatus {
    ACTIVE, INACTIVE, BANNED
}
```

### 2.1.3 Chá»©c nÄƒng 1: ÄÄ‚NG KÃ NGÆ¯á»œI DÃ™NG

#### Thiáº¿t káº¿ giao diá»‡n

**Client Side - Form Ä‘Äƒng kÃ½:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ÄÄ‚NG KÃ TÃ€I KHOáº¢N          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  TÃªn Ä‘Äƒng nháº­p: [_______________]    â”‚
â”‚                                      â”‚
â”‚  Email:         [_______________]    â”‚
â”‚                                      â”‚
â”‚  Máº­t kháº©u:      [_______________]    â”‚
â”‚                                      â”‚
â”‚  XÃ¡c nháº­n MK:   [_______________]    â”‚
â”‚                                      â”‚
â”‚  Há» tÃªn:        [_______________]    â”‚
â”‚                                      â”‚
â”‚  Sá»‘ Ä‘iá»‡n thoáº¡i: [_______________]    â”‚
â”‚                                      â”‚
â”‚  [âœ“] Äá»“ng Ã½ Ä‘iá»u khoáº£n sá»­ dá»¥ng      â”‚
â”‚                                      â”‚
â”‚     [ÄÄƒng kÃ½]    [Há»§y]              â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Server Side - Admin Panel:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         QUáº¢N LÃ ÄÄ‚NG KÃ Má»šI              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Danh sÃ¡ch tÃ i khoáº£n chá» duyá»‡t:           â”‚
â”‚                                            â”‚
â”‚ â”Œâ”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚IDâ”‚ Username â”‚  Email  â”‚   HÃ nh Ä‘á»™ng  â”‚ â”‚
â”‚ â”œâ”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚1 â”‚ user01   â”‚ a@b.com â”‚ [Duyá»‡t][Tá»« chá»‘i]â”‚ â”‚
â”‚ â”‚2 â”‚ user02   â”‚ c@d.com â”‚ [Duyá»‡t][Tá»« chá»‘i]â”‚ â”‚
â”‚ â””â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Biá»ƒu Ä‘á»“ lá»›p chi tiáº¿t

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   RegisterController    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - userService: IUserSvc â”‚
â”‚ - validator: Validator  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + register(): Response  â”‚
â”‚ + validateInput(): bool â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ uses
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   UserService           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - userRepo: IUserRepo   â”‚
â”‚ - emailService: IEmail  â”‚
â”‚ - encoder: IEncoder     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + createUser(): User    â”‚
â”‚ + checkExists(): bool   â”‚
â”‚ + hashPassword(): stringâ”‚
â”‚ + sendWelcomeEmail()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ uses
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   UserRepository        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - db: DatabaseConnectionâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + save(user: User): boolâ”‚
â”‚ + findByEmail(): User   â”‚
â”‚ + findByUsername(): Userâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**LÃ½ do thiáº¿t káº¿:**
- **Controller**: TÃ¡ch biá»‡t logic xá»­ lÃ½ request/response vá»›i business logic
- **Service**: Chá»©a business logic, Ä‘áº£m báº£o Single Responsibility Principle
- **Repository**: TÃ¡ch biá»‡t data access layer, dá»… thay Ä‘á»•i database sau nÃ y
- **Interface**: Sá»­ dá»¥ng interface Ä‘á»ƒ Ä‘áº£m báº£o Dependency Inversion Principle

#### Biá»ƒu Ä‘á»“ hoáº¡t Ä‘á»™ng

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Start  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Nháº­p thÃ´ng tin   â”‚
â”‚    Ä‘Äƒng kÃ½       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡
   â•±           â•²
  â•±   Validate  â•²     KhÃ´ng há»£p lá»‡
 â—‡   thÃ´ng tin   â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â•²             â•±              â”‚
   â•²           â•±               â”‚
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡                â”‚
         â”‚ Há»£p lá»‡              â”‚
         â–¼                     â”‚
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡                â”‚
   â•±           â•²               â”‚
  â•±  Username   â•²   Tá»“n táº¡i   â”‚
 â—‡   tá»“n táº¡i?    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â•²             â•±              â”‚
   â•²           â•±               â”‚
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡                â”‚
         â”‚ KhÃ´ng               â”‚
         â–¼                     â”‚
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡                â”‚
   â•±           â•²               â”‚
  â•±    Email    â•²   Tá»“n táº¡i   â”‚
 â—‡   tá»“n táº¡i?    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â•²             â•±              â”‚
   â•²           â•±               â”‚
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡                â”‚
         â”‚ KhÃ´ng               â”‚
         â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  MÃ£ hÃ³a máº­t kháº©u â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
         â”‚                     â”‚
         â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  LÆ°u vÃ o CSDL    â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
         â”‚                     â”‚
         â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚ Gá»­i email xÃ¡c   â”‚            â”‚
â”‚     nháº­n         â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
         â”‚                     â”‚
         â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ThÃ´ng bÃ¡o thÃ nh  â”‚    â”‚ Hiá»ƒn thá»‹ lá»—i â”‚
â”‚      cÃ´ng        â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   End   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Biá»ƒu Ä‘á»“ tuáº§n tá»±

```
Client          Controller      UserService      UserRepo        EmailService     Database
  â”‚                 â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚â”€â”€Registerâ”€â”€â”€â”€â–¶â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚  Request       â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚â”€â”€validate()â”€â”€â–¶â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚                â”‚â”€â”€checkExistsâ”€â–¶â”‚               â”‚               â”‚
  â”‚                 â”‚                â”‚  (username)   â”‚               â”‚               â”‚
  â”‚                 â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚                â”‚               â”‚â”€â”€SELECTâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                 â”‚                â”‚               â”‚   FROM users                 â”‚
  â”‚                 â”‚                â”‚               â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€nullâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                 â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚                â”‚â—€â”€â”€not existsâ”€â”€â”‚               â”‚               â”‚
  â”‚                 â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚                â”‚â”€â”€checkExistsâ”€â–¶â”‚               â”‚               â”‚
  â”‚                 â”‚                â”‚   (email)     â”‚               â”‚               â”‚
  â”‚                 â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚                â”‚               â”‚â”€â”€SELECTâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                 â”‚                â”‚               â”‚   FROM users                 â”‚
  â”‚                 â”‚                â”‚               â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€nullâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                 â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚                â”‚â—€â”€â”€not existsâ”€â”€â”‚               â”‚               â”‚
  â”‚                 â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚â”€â”€hashPasswordâ”€â–¶â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚â—€â”€â”€hashedPwdâ”€â”€â”€â”€â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚â”€â”€createUserâ”€â”€â”€â–¶â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚                â”‚â”€â”€save(user)â”€â”€â–¶â”‚                â”‚               â”‚
  â”‚                 â”‚                â”‚               â”‚â”€â”€INSERT INTOâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                 â”‚                â”‚               â”‚     users                    â”‚
  â”‚                 â”‚                â”‚               â”‚â—€â”€â”€â”€â”€â”€â”€user_idâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                 â”‚                â”‚â—€â”€â”€successâ”€â”€â”€â”€â”€â”‚                â”‚               â”‚
  â”‚                 â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚                â”‚â”€â”€sendEmailâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚               â”‚
  â”‚                 â”‚                â”‚               â”‚                â”‚â”€â”€send()â”€â”€â”€â”€â–¶â”‚
  â”‚                 â”‚                â”‚               â”‚                â”‚â—€â”€â”€â”€â”€OKâ”€â”€â”€â”€â”€â”€â”‚
  â”‚                 â”‚                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€email sentâ”€â”€â”€â”€â”€â”€â”‚               â”‚
  â”‚                 â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚â—€â”€â”€User createdâ”€â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚â—€â”€â”€Responseâ”€â”€â”€â”€â”€â”€â”‚               â”‚               â”‚                â”‚               â”‚
  â”‚   (success)     â”‚                â”‚               â”‚                â”‚               â”‚
```

### 2.1.4 Chá»©c nÄƒng 2: ÄÄ‚NG NHáº¬P

#### Thiáº¿t káº¿ giao diá»‡n

**Client Side - Form Ä‘Äƒng nháº­p:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ÄÄ‚NG NHáº¬P                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  Email/Username: [_______________]   â”‚
â”‚                                      â”‚
â”‚  Máº­t kháº©u:       [_______________]   â”‚
â”‚                                      â”‚
â”‚  [âœ“] Ghi nhá»› Ä‘Äƒng nháº­p              â”‚
â”‚                                      â”‚
â”‚     [ÄÄƒng nháº­p]    [QuÃªn MK?]       â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HOáº¶C â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚
â”‚                                      â”‚
â”‚  [ÄÄƒng nháº­p vá»›i Google]              â”‚
â”‚  [ÄÄƒng nháº­p vá»›i Facebook]            â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Server Side - Session Management:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        QUáº¢N LÃ PHIÃŠN ÄÄ‚NG NHáº¬P           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Sessions hiá»‡n táº¡i:                        â”‚
â”‚                                            â”‚
â”‚ â”Œâ”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚IDâ”‚ Username â”‚   IP    â”‚   Thá»i gian  â”‚ â”‚
â”‚ â”œâ”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚1 â”‚ admin    â”‚127.0.0.1â”‚ 10:30:25     â”‚ â”‚
â”‚ â”‚2 â”‚ user01   â”‚192.168.1â”‚ 11:45:12     â”‚ â”‚
â”‚ â””â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                            â”‚
â”‚ [Terminate All Sessions] [Refresh]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Biá»ƒu Ä‘á»“ lá»›p chi tiáº¿t

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    LoginController      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - authService: IAuthSvc â”‚
â”‚ - tokenService: IToken  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + login(): Response     â”‚
â”‚ + logout(): Response    â”‚
â”‚ + refreshToken(): Token â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ uses
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AuthService           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - userRepo: IUserRepo   â”‚
â”‚ - tokenGen: ITokenGen   â”‚
â”‚ - encoder: IEncoder     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + authenticate(): User  â”‚
â”‚ + verifyPassword(): boolâ”‚
â”‚ + generateTokens(): Map â”‚
â”‚ + createSession(): void â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ uses
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SessionRepository     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - cache: RedisClient    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + createSession(): void â”‚
â”‚ + getSession(): Session â”‚
â”‚ + deleteSession(): void â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Biá»ƒu Ä‘á»“ hoáº¡t Ä‘á»™ng

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Start  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Nháº­p username/   â”‚
â”‚ email & password â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡
   â•±           â•²
  â•±   Validate  â•²     KhÃ´ng há»£p lá»‡
 â—‡   thÃ´ng tin   â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â•²             â•±              â”‚
   â•²           â•±               â”‚
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡                â”‚
         â”‚ Há»£p lá»‡              â”‚
         â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚ TÃ¬m user trong   â”‚           â”‚
â”‚      CSDL        â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
         â”‚                     â”‚
         â–¼                     â”‚
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡                â”‚
   â•±           â•²               â”‚
  â•±    User     â•²  KhÃ´ng cÃ³   â”‚
 â—‡   tá»“n táº¡i?    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â•²             â•±              â”‚
   â•²           â•±               â”‚
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡                â”‚
         â”‚ CÃ³                  â”‚
         â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚ Verify password  â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
         â”‚                     â”‚
         â–¼                     â”‚
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡                â”‚
   â•±           â•²               â”‚
  â•±  Password   â•²    Sai       â”‚
 â—‡   Ä‘Ãºng?       â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â•²             â•±              â”‚
   â•²           â•±               â”‚
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡                â”‚
         â”‚ ÄÃºng                â”‚
         â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚ Generate JWT     â”‚           â”‚
â”‚     tokens       â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
         â”‚                     â”‚
         â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚ Create session   â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
         â”‚                     â”‚
         â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Return tokens    â”‚    â”‚ Return error â”‚
â”‚ & user info      â”‚    â”‚   message    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   End   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Biá»ƒu Ä‘á»“ tuáº§n tá»±

```
Client          Controller      AuthService      UserRepo        SessionRepo      Database
  â”‚                 â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚â”€â”€Loginâ”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚  Request       â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚â”€â”€validate()â”€â”€â–¶â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚                â”‚â”€â”€findUserâ”€â”€â”€â”€â–¶â”‚               â”‚               â”‚
  â”‚                 â”‚                â”‚               â”‚â”€â”€SELECTâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                 â”‚                â”‚               â”‚   FROM users                 â”‚
  â”‚                 â”‚                â”‚               â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€user dataâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                 â”‚                â”‚â—€â”€â”€â”€userâ”€â”€â”€â”€â”€â”€â”€â”‚               â”‚               â”‚
  â”‚                 â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚â”€â”€verifyPwdâ”€â”€â”€â”€â–¶â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚â—€â”€â”€â”€trueâ”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚â”€â”€generateJWTâ”€â”€â–¶â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚â—€â”€â”€tokensâ”€â”€â”€â”€â”€â”€â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚                 â”‚â”€â”€createSessionâ”€â–¶â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚               â”‚
  â”‚                 â”‚                â”‚               â”‚                â”‚â”€â”€SAVEâ”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                 â”‚                â”‚               â”‚                â”‚   (Redis)    â”‚
  â”‚                 â”‚                â”‚               â”‚                â”‚â—€â”€â”€â”€â”€OKâ”€â”€â”€â”€â”€â”€â”‚
  â”‚                 â”‚â—€â”€â”€sessionIdâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—€â”‚               â”‚
  â”‚                 â”‚                â”‚               â”‚                â”‚               â”‚
  â”‚â—€â”€â”€Responseâ”€â”€â”€â”€â”€â”€â”‚               â”‚               â”‚                â”‚               â”‚
  â”‚  (tokens)      â”‚                â”‚               â”‚                â”‚               â”‚
```

---

## 2.2 THIáº¾T Káº¾ CHI TIáº¾T - LÃŠ VÄ‚N TRá»ŒNG (MÃƒ SV: 20210002)
### Module: Quáº£n lÃ½ sáº£n pháº©m

### 2.2.1 Thiáº¿t káº¿ CSDL

#### Báº£ng Products
```sql
CREATE TABLE products (
    product_id INT PRIMARY KEY AUTO_INCREMENT,
    product_code VARCHAR(50) UNIQUE NOT NULL,
    product_name VARCHAR(200) NOT NULL,
    description TEXT,
    price DECIMAL(10, 2) NOT NULL,
    discount_price DECIMAL(10, 2),
    quantity INT DEFAULT 0,
    category_id INT,
    brand_id INT,
    status ENUM('active', 'inactive', 'out_of_stock') DEFAULT 'active',
    views INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (category_id) REFERENCES categories(category_id),
    FOREIGN KEY (brand_id) REFERENCES brands(brand_id)
);
```

#### Báº£ng Categories
```sql
CREATE TABLE categories (
    category_id INT PRIMARY KEY AUTO_INCREMENT,
    category_name VARCHAR(100) NOT NULL,
    parent_id INT,
    slug VARCHAR(100) UNIQUE,
    description TEXT,
    image_url VARCHAR(500),
    sort_order INT DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (parent_id) REFERENCES categories(category_id)
);
```

#### Báº£ng Product_Images
```sql
CREATE TABLE product_images (
    image_id INT PRIMARY KEY AUTO_INCREMENT,
    product_id INT,
    image_url VARCHAR(500) NOT NULL,
    alt_text VARCHAR(200),
    is_primary BOOLEAN DEFAULT FALSE,
    sort_order INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (product_id) REFERENCES products(product_id) ON DELETE CASCADE
);
```

#### Báº£ng Product_Attributes
```sql
CREATE TABLE product_attributes (
    attribute_id INT PRIMARY KEY AUTO_INCREMENT,
    product_id INT,
    attribute_name VARCHAR(100),
    attribute_value VARCHAR(200),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (product_id) REFERENCES products(product_id) ON DELETE CASCADE
);
```

### 2.2.2 Thiáº¿t káº¿ lá»›p thá»±c thá»ƒ

```java
// Entity: Product
public class Product {
    private int productId;
    private String productCode;
    private String productName;
    private String description;
    private BigDecimal price;
    private BigDecimal discountPrice;
    private int quantity;
    private Category category;
    private Brand brand;
    private ProductStatus status;
    private List<ProductImage> images;
    private List<ProductAttribute> attributes;
    private int views;
    private Date createdAt;
    private Date updatedAt;

    // Methods
    public boolean isInStock() {
        return quantity > 0 && status == ProductStatus.ACTIVE;
    }

    public BigDecimal getFinalPrice() {
        return discountPrice != null ? discountPrice : price;
    }

    // Constructors, getters, setters
}

// Entity: Category
public class Category {
    private int categoryId;
    private String categoryName;
    private Category parentCategory;
    private String slug;
    private String description;
    private String imageUrl;
    private int sortOrder;
    private boolean isActive;
    private List<Product> products;
    private Date createdAt;

    // Constructors, getters, setters
}

// Entity: ProductImage
public class ProductImage {
    private int imageId;
    private int productId;
    private String imageUrl;
    private String altText;
    private boolean isPrimary;
    private int sortOrder;
    private Date createdAt;

    // Constructors, getters, setters
}

// Enum: ProductStatus
public enum ProductStatus {
    ACTIVE, INACTIVE, OUT_OF_STOCK
}
```

### 2.2.3 Chá»©c nÄƒng 1: THÃŠM Sáº¢N PHáº¨M Má»šI

#### Thiáº¿t káº¿ giao diá»‡n

**Server Side - Admin Panel:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             THÃŠM Sáº¢N PHáº¨M Má»šI                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                               â”‚
â”‚ MÃ£ sáº£n pháº©m:  [_______________] *            â”‚
â”‚                                               â”‚
â”‚ TÃªn sáº£n pháº©m: [_________________________] *  â”‚
â”‚                                               â”‚
â”‚ Danh má»¥c:     [â–¼ Chá»n danh má»¥c        ] *    â”‚
â”‚                                               â”‚
â”‚ ThÆ°Æ¡ng hiá»‡u:  [â–¼ Chá»n thÆ°Æ¡ng hiá»‡u     ]      â”‚
â”‚                                               â”‚
â”‚ GiÃ¡ gá»‘c:      [_______________] VNÄ *        â”‚
â”‚                                               â”‚
â”‚ GiÃ¡ khuyáº¿n mÃ£i: [_______________] VNÄ        â”‚
â”‚                                               â”‚
â”‚ Sá»‘ lÆ°á»£ng:     [_______________] *            â”‚
â”‚                                               â”‚
â”‚ MÃ´ táº£ chi tiáº¿t:                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚                                       â”‚    â”‚
â”‚ â”‚                                       â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                               â”‚
â”‚ HÃ¬nh áº£nh:     [Choose Files] (Max: 5)        â”‚
â”‚ â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”         â”‚
â”‚ â”‚    â”‚ â”‚    â”‚ â”‚    â”‚ â”‚    â”‚ â”‚    â”‚         â”‚
â”‚ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜         â”‚
â”‚                                               â”‚
â”‚ Thuá»™c tÃ­nh sáº£n pháº©m:                         â”‚
â”‚ [+ ThÃªm thuá»™c tÃ­nh]                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚ â”‚ TÃªn thuá»™c tÃ­nh  â”‚  GiÃ¡ trá»‹        â”‚        â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚ â”‚ MÃ u sáº¯c        â”‚ Äen, Tráº¯ng, Xanhâ”‚        â”‚
â”‚ â”‚ KÃ­ch thÆ°á»›c     â”‚ S, M, L, XL     â”‚        â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                               â”‚
â”‚    [LÆ°u sáº£n pháº©m]    [Há»§y]                  â”‚
â”‚                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Client Side - Product Display:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CHI TIáº¾T Sáº¢N PHáº¨M           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚ â”‚          â”‚  TÃªn sáº£n pháº©m           â”‚
â”‚ â”‚  HÃ¬nh    â”‚  GiÃ¡: 500,000 VNÄ       â”‚
â”‚ â”‚   áº£nh    â”‚  â­â­â­â­â­ (4.5/5)        â”‚
â”‚ â”‚          â”‚                         â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Sá»‘ lÆ°á»£ng: [1] [-][+]   â”‚
â”‚                                      â”‚
â”‚ [ThÃªm vÃ o giá»] [Mua ngay]          â”‚
â”‚                                      â”‚
â”‚ MÃ´ táº£ sáº£n pháº©m:                     â”‚
â”‚ ....................................  â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Biá»ƒu Ä‘á»“ lá»›p chi tiáº¿t

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ProductController      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - productService: IProdSvcâ”‚
â”‚ - validator: Validator   â”‚
â”‚ - fileUpload: IFileUploadâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + createProduct(): Resp  â”‚
â”‚ + updateProduct(): Resp  â”‚
â”‚ + deleteProduct(): Resp  â”‚
â”‚ + getProducts(): List    â”‚
â”‚ + uploadImages(): List   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ uses
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ProductService         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - productRepo: IProdRepo â”‚
â”‚ - categoryRepo: ICatRepo â”‚
â”‚ - imageService: IImageSvcâ”‚
â”‚ - cacheService: ICache   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + addProduct(): Product  â”‚
â”‚ + validateSKU(): bool    â”‚
â”‚ + processImages(): void  â”‚
â”‚ + updateStock(): void    â”‚
â”‚ + calculatePrice(): BigDecâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ uses
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ProductRepository      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - db: DatabaseConnection â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + save(prod: Product): intâ”‚
â”‚ + update(prod: Product)  â”‚
â”‚ + findById(id: int): Prodâ”‚
â”‚ + findBySKU(sku: String) â”‚
â”‚ + findByCategory(): List â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**LÃ½ do thiáº¿t káº¿:**
- **Controller**: Xá»­ lÃ½ HTTP requests, validation Ä‘áº§u vÃ o vÃ  upload files
- **Service**: Chá»©a business logic phá»©c táº¡p nhÆ° tÃ­nh giÃ¡, xá»­ lÃ½ hÃ¬nh áº£nh, cache
- **Repository**: Quáº£n lÃ½ truy xuáº¥t dá»¯ liá»‡u, tá»‘i Æ°u query
- **Separation of Concerns**: Má»—i layer cÃ³ trÃ¡ch nhiá»‡m riÃªng biá»‡t

#### Biá»ƒu Ä‘á»“ hoáº¡t Ä‘á»™ng

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Start  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Nháº­p thÃ´ng tin   â”‚
â”‚   sáº£n pháº©m       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡
   â•±           â•²
  â•±  Validate   â•²     KhÃ´ng há»£p lá»‡
 â—‡  thÃ´ng tin    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â•²             â•±              â”‚
   â•²           â•±               â”‚
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡                â”‚
         â”‚ Há»£p lá»‡              â”‚
         â–¼                     â”‚
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡                â”‚
   â•±           â•²               â”‚
  â•±   MÃ£ SP     â•²   ÄÃ£ cÃ³     â”‚
 â—‡   tá»“n táº¡i?    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â•²             â•±              â”‚
   â•²           â•±               â”‚
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡                â”‚
         â”‚ ChÆ°a cÃ³             â”‚
         â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚ Upload hÃ¬nh áº£nh  â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
         â”‚                     â”‚
         â–¼                     â”‚
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡                â”‚
   â•±           â•²               â”‚
  â•±   Upload    â•²    Lá»—i      â”‚
 â—‡   thÃ nh cÃ´ng? â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â•²             â•±              â”‚
   â•²           â•±               â”‚
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡                â”‚
         â”‚ OK                  â”‚
         â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚ Resize & optimizeâ”‚           â”‚
â”‚     images       â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
         â”‚                     â”‚
         â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚ LÆ°u thÃ´ng tin SP â”‚           â”‚
â”‚   vÃ o database   â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
         â”‚                     â”‚
         â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚ Clear cache      â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
         â”‚                     â”‚
         â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ThÃ´ng bÃ¡o thÃ nh  â”‚    â”‚ Hiá»ƒn thá»‹ lá»—i â”‚
â”‚      cÃ´ng        â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   End   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Biá»ƒu Ä‘á»“ tuáº§n tá»±

```
Admin           Controller      ProductService    ProductRepo      ImageService     Database
  â”‚                 â”‚                 â”‚                â”‚                â”‚               â”‚
  â”‚â”€â”€AddProductâ”€â”€â”€â–¶â”‚                 â”‚                â”‚                â”‚               â”‚
  â”‚   Request      â”‚                 â”‚                â”‚                â”‚               â”‚
  â”‚                â”‚                 â”‚                â”‚                â”‚               â”‚
  â”‚                â”‚â”€â”€validate()â”€â”€â”€â”€â–¶â”‚                â”‚                â”‚               â”‚
  â”‚                â”‚                 â”‚                â”‚                â”‚               â”‚
  â”‚                â”‚                 â”‚â”€â”€checkSKUâ”€â”€â”€â”€â”€â–¶â”‚                â”‚               â”‚
  â”‚                â”‚                 â”‚                â”‚â”€â”€SELECTâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                â”‚                 â”‚                â”‚   FROM products              â”‚
  â”‚                â”‚                 â”‚                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€nullâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                â”‚                 â”‚â—€â”€â”€not existsâ”€â”€â”€â”‚                â”‚               â”‚
  â”‚                â”‚                 â”‚                â”‚                â”‚               â”‚
  â”‚                â”‚â”€â”€uploadImagesâ”€â”€â–¶â”‚                â”‚                â”‚               â”‚
  â”‚                â”‚                 â”‚â”€â”€processImgâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚               â”‚
  â”‚                â”‚                 â”‚                â”‚                â”‚â”€â”€uploadâ”€â”€â”€â”€â–¶â”‚
  â”‚                â”‚                 â”‚                â”‚                â”‚   (S3/Local) â”‚
  â”‚                â”‚                 â”‚                â”‚                â”‚â—€â”€â”€â”€URLsâ”€â”€â”€â”€â”€â”‚
  â”‚                â”‚                 â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€image URLsâ”€â”€â”€â”€â”€â”€â”‚               â”‚
  â”‚                â”‚                 â”‚                â”‚                â”‚               â”‚
  â”‚                â”‚â”€â”€createProductâ”€â–¶â”‚                â”‚                â”‚               â”‚
  â”‚                â”‚                 â”‚â”€â”€saveâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                â”‚               â”‚
  â”‚                â”‚                 â”‚                â”‚â”€â”€INSERT INTOâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                â”‚                 â”‚                â”‚   products                   â”‚
  â”‚                â”‚                 â”‚                â”‚â—€â”€â”€â”€â”€product_idâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                â”‚                 â”‚                â”‚                â”‚               â”‚
  â”‚                â”‚                 â”‚                â”‚â”€â”€INSERT INTOâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                â”‚                 â”‚                â”‚ product_images               â”‚
  â”‚                â”‚                 â”‚                â”‚â—€â”€â”€â”€â”€â”€â”€OKâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                â”‚                 â”‚â—€â”€â”€product_idâ”€â”€â”€â”‚                â”‚               â”‚
  â”‚                â”‚                 â”‚                â”‚                â”‚               â”‚
  â”‚                â”‚                 â”‚â”€â”€clearCache()â”€â–¶â”‚                â”‚               â”‚
  â”‚                â”‚                 â”‚                â”‚                â”‚               â”‚
  â”‚                â”‚â—€â”€â”€Product createdâ”‚                â”‚                â”‚               â”‚
  â”‚                â”‚                 â”‚                â”‚                â”‚               â”‚
  â”‚â—€â”€â”€Responseâ”€â”€â”€â”€â”€â”€â”‚                â”‚                â”‚                â”‚               â”‚
  â”‚   (success)    â”‚                 â”‚                â”‚                â”‚               â”‚
```

### 2.2.4 Chá»©c nÄƒng 2: TÃŒM KIáº¾M VÃ€ Lá»ŒC Sáº¢N PHáº¨M

#### Thiáº¿t káº¿ giao diá»‡n

**Client Side - Search & Filter:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      TÃŒM KIáº¾M Sáº¢N PHáº¨M              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ğŸ” Nháº­p tá»« khÃ³a...        ] [TÃ¬m]   â”‚
â”‚                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚  Bá»˜ Lá»ŒC     â”‚ â”‚   Káº¾T QUáº¢       â”‚â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚                  â”‚â”‚
â”‚ â”‚Danh má»¥c:    â”‚ â”‚ TÃ¬m tháº¥y: 25 SP  â”‚â”‚
â”‚ â”‚[âœ“] Äiá»‡n tá»­  â”‚ â”‚                  â”‚â”‚
â”‚ â”‚[ ] Thá»i trangâ”‚ â”‚ Sáº¯p xáº¿p: [â–¼GiÃ¡] â”‚â”‚
â”‚ â”‚[ ] Gia dá»¥ng â”‚ â”‚                  â”‚â”‚
â”‚ â”‚             â”‚ â”‚ â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”   â”‚â”‚
â”‚ â”‚GiÃ¡:         â”‚ â”‚ â”‚ SP1â”‚ â”‚ SP2â”‚   â”‚â”‚
â”‚ â”‚Min: [____]  â”‚ â”‚ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜   â”‚â”‚
â”‚ â”‚Max: [____]  â”‚ â”‚ â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”   â”‚â”‚
â”‚ â”‚             â”‚ â”‚ â”‚ SP3â”‚ â”‚ SP4â”‚   â”‚â”‚
â”‚ â”‚ThÆ°Æ¡ng hiá»‡u: â”‚ â”‚ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜   â”‚â”‚
â”‚ â”‚[âœ“] Samsung  â”‚ â”‚                  â”‚â”‚
â”‚ â”‚[ ] Apple    â”‚ â”‚ [1][2][3]...[10] â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Biá»ƒu Ä‘á»“ lá»›p chi tiáº¿t

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SearchController       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - searchService: ISearch â”‚
â”‚ - filterBuilder: IFilter â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + search(): SearchResult â”‚
â”‚ + filter(): List<Product>â”‚
â”‚ + suggest(): List<String>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ uses
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SearchService          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - productRepo: IProdRepo â”‚
â”‚ - elasticClient: IElasticâ”‚
â”‚ - cacheService: ICache   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + searchProducts(): List â”‚
â”‚ + buildQuery(): Query    â”‚
â”‚ + applyFilters(): List   â”‚
â”‚ + rankResults(): List    â”‚
â”‚ + indexProduct(): void   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Biá»ƒu Ä‘á»“ hoáº¡t Ä‘á»™ng & tuáº§n tá»± (TÆ°Æ¡ng tá»± cáº¥u trÃºc nhÆ° trÃªn)

---

## 2.3 THIáº¾T Káº¾ CHI TIáº¾T - PHáº M VÄ‚N THUÃ‚N (MÃƒ SV: 20210003)
### Module: Quáº£n lÃ½ Ä‘Æ¡n hÃ ng

### 2.3.1 Thiáº¿t káº¿ CSDL

#### Báº£ng Orders
```sql
CREATE TABLE orders (
    order_id INT PRIMARY KEY AUTO_INCREMENT,
    order_code VARCHAR(50) UNIQUE NOT NULL,
    user_id INT NOT NULL,
    total_amount DECIMAL(10, 2) NOT NULL,
    discount_amount DECIMAL(10, 2) DEFAULT 0,
    shipping_fee DECIMAL(10, 2) DEFAULT 0,
    final_amount DECIMAL(10, 2) NOT NULL,
    payment_method ENUM('cod', 'bank_transfer', 'credit_card', 'e_wallet'),
    payment_status ENUM('pending', 'paid', 'failed', 'refunded') DEFAULT 'pending',
    order_status ENUM('pending', 'confirmed', 'processing', 'shipping', 'delivered', 'cancelled') DEFAULT 'pending',
    shipping_address TEXT,
    shipping_phone VARCHAR(20),
    notes TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
);
```

#### Báº£ng Order_Items
```sql
CREATE TABLE order_items (
    item_id INT PRIMARY KEY AUTO_INCREMENT,
    order_id INT NOT NULL,
    product_id INT NOT NULL,
    quantity INT NOT NULL,
    unit_price DECIMAL(10, 2) NOT NULL,
    discount_price DECIMAL(10, 2),
    subtotal DECIMAL(10, 2) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (order_id) REFERENCES orders(order_id) ON DELETE CASCADE,
    FOREIGN KEY (product_id) REFERENCES products(product_id)
);
```

#### Báº£ng Cart
```sql
CREATE TABLE cart (
    cart_id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    product_id INT NOT NULL,
    quantity INT NOT NULL DEFAULT 1,
    added_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY unique_user_product (user_id, product_id),
    FOREIGN KEY (user_id) REFERENCES users(user_id),
    FOREIGN KEY (product_id) REFERENCES products(product_id)
);
```

#### Báº£ng Payment_Transactions
```sql
CREATE TABLE payment_transactions (
    transaction_id INT PRIMARY KEY AUTO_INCREMENT,
    order_id INT NOT NULL,
    transaction_code VARCHAR(100) UNIQUE,
    payment_method VARCHAR(50),
    amount DECIMAL(10, 2) NOT NULL,
    status ENUM('pending', 'success', 'failed', 'cancelled') DEFAULT 'pending',
    gateway_response TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    completed_at TIMESTAMP NULL,
    FOREIGN KEY (order_id) REFERENCES orders(order_id)
);
```

### 2.3.2 Thiáº¿t káº¿ lá»›p thá»±c thá»ƒ

```java
// Entity: Order
public class Order {
    private int orderId;
    private String orderCode;
    private User user;
    private BigDecimal totalAmount;
    private BigDecimal discountAmount;
    private BigDecimal shippingFee;
    private BigDecimal finalAmount;
    private PaymentMethod paymentMethod;
    private PaymentStatus paymentStatus;
    private OrderStatus orderStatus;
    private String shippingAddress;
    private String shippingPhone;
    private String notes;
    private List<OrderItem> orderItems;
    private Date createdAt;
    private Date updatedAt;

    // Methods
    public void calculateTotal() {
        this.totalAmount = orderItems.stream()
            .map(OrderItem::getSubtotal)
            .reduce(BigDecimal.ZERO, BigDecimal::add);
        this.finalAmount = totalAmount
            .subtract(discountAmount)
            .add(shippingFee);
    }

    // Constructors, getters, setters
}

// Entity: OrderItem
public class OrderItem {
    private int itemId;
    private int orderId;
    private Product product;
    private int quantity;
    private BigDecimal unitPrice;
    private BigDecimal discountPrice;
    private BigDecimal subtotal;
    private Date createdAt;

    public void calculateSubtotal() {
        BigDecimal price = discountPrice != null ? discountPrice : unitPrice;
        this.subtotal = price.multiply(BigDecimal.valueOf(quantity));
    }

    // Constructors, getters, setters
}

// Entity: Cart
public class Cart {
    private int cartId;
    private User user;
    private Product product;
    private int quantity;
    private Date addedAt;
    private Date updatedAt;

    // Constructors, getters, setters
}

// Enums
public enum OrderStatus {
    PENDING, CONFIRMED, PROCESSING, SHIPPING, DELIVERED, CANCELLED
}

public enum PaymentStatus {
    PENDING, PAID, FAILED, REFUNDED
}

public enum PaymentMethod {
    COD, BANK_TRANSFER, CREDIT_CARD, E_WALLET
}
```

### 2.3.3 Chá»©c nÄƒng 1: GIá» HÃ€NG VÃ€ Äáº¶T HÃ€NG

#### Thiáº¿t káº¿ giao diá»‡n

**Client Side - Shopping Cart:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            GIá» HÃ€NG                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ [âœ“] â”‚ Sáº£n pháº©m A â”‚ SL: [-][2][+]â”‚ â”‚
â”‚ â”‚     â”‚ 500,000Ä‘   â”‚ = 1,000,000Ä‘â”‚ â”‚
â”‚ â”‚     â”‚            â”‚ [XÃ³a]       â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚ [âœ“] â”‚ Sáº£n pháº©m B â”‚ SL: [-][1][+]â”‚ â”‚
â”‚ â”‚     â”‚ 300,000Ä‘   â”‚ = 300,000Ä‘  â”‚ â”‚
â”‚ â”‚     â”‚            â”‚ [XÃ³a]       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚
â”‚ Táº¡m tÃ­nh:           1,300,000 VNÄ   â”‚
â”‚ PhÃ­ váº­n chuyá»ƒn:        30,000 VNÄ   â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚ Tá»•ng cá»™ng:          1,330,000 VNÄ   â”‚
â”‚                                      â”‚
â”‚ MÃ£ giáº£m giÃ¡: [___________] [Ãp dá»¥ng]â”‚
â”‚                                      â”‚
â”‚ [Tiáº¿p tá»¥c mua hÃ ng] [Thanh toÃ¡n]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Client Side - Checkout:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          THANH TOÃN                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ THÃ”NG TIN GIAO HÃ€NG                 â”‚
â”‚                                      â”‚
â”‚ Há» tÃªn:     [___________________]   â”‚
â”‚ Äiá»‡n thoáº¡i: [___________________]   â”‚
â”‚ Äá»‹a chá»‰:    [___________________]   â”‚
â”‚             [___________________]   â”‚
â”‚                                      â”‚
â”‚ PHÆ¯Æ NG THá»¨C THANH TOÃN              â”‚
â”‚ ( ) Thanh toÃ¡n khi nháº­n hÃ ng (COD)  â”‚
â”‚ ( ) Chuyá»ƒn khoáº£n ngÃ¢n hÃ ng          â”‚
â”‚ (â—) Tháº» tÃ­n dá»¥ng/Debit              â”‚
â”‚ ( ) VÃ­ Ä‘iá»‡n tá»­                      â”‚
â”‚                                      â”‚
â”‚ THÃ”NG TIN ÄÆ N HÃ€NG                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚ â”‚ 2 sáº£n pháº©m    1,300,000Ä‘ â”‚      â”‚
â”‚ â”‚ Váº­n chuyá»ƒn       30,000Ä‘ â”‚      â”‚
â”‚ â”‚ Giáº£m giÃ¡        -50,000Ä‘ â”‚      â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚      â”‚
â”‚ â”‚ Tá»•ng:        1,280,000Ä‘  â”‚      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                      â”‚
â”‚ Ghi chÃº: [___________________]      â”‚
â”‚                                      â”‚
â”‚    [Äáº·t hÃ ng]    [Quay láº¡i]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Biá»ƒu Ä‘á»“ lá»›p chi tiáº¿t

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   OrderController        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - orderService: IOrderSvcâ”‚
â”‚ - cartService: ICartSvc  â”‚
â”‚ - paymentSvc: IPaymentSvcâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + addToCart(): Response  â”‚
â”‚ + updateCart(): Response â”‚
â”‚ + checkout(): Response   â”‚
â”‚ + placeOrder(): Order    â”‚
â”‚ + getOrderStatus(): Statusâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ uses
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   OrderService           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - orderRepo: IOrderRepo  â”‚
â”‚ - productRepo: IProdRepo â”‚
â”‚ - inventorySvc: IInventoryâ”‚
â”‚ - emailService: IEmail   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + createOrder(): Order   â”‚
â”‚ + validateStock(): bool  â”‚
â”‚ + reserveStock(): bool   â”‚
â”‚ + calculateTotal(): BigDecâ”‚
â”‚ + processPayment(): bool â”‚
â”‚ + sendConfirmation(): voidâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ uses
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   OrderRepository        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - db: DatabaseConnection â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + save(order: Order): intâ”‚
â”‚ + findById(id: int): Orderâ”‚
â”‚ + findByUser(uid: int):Listâ”‚
â”‚ + updateStatus(): bool   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**LÃ½ do thiáº¿t káº¿:**
- **Controller**: Äiá»u phá»‘i luá»“ng Ä‘áº·t hÃ ng tá»« giá» hÃ ng Ä‘áº¿n thanh toÃ¡n
- **Service**: Xá»­ lÃ½ logic phá»©c táº¡p nhÆ° kiá»ƒm tra tá»“n kho, tÃ­nh toÃ¡n, thanh toÃ¡n
- **Repository**: Quáº£n lÃ½ transaction Ä‘áº£m báº£o tÃ­nh toÃ n váº¹n dá»¯ liá»‡u
- **Integration**: TÃ­ch há»£p vá»›i cÃ¡c service khÃ¡c (inventory, payment, email)

#### Biá»ƒu Ä‘á»“ hoáº¡t Ä‘á»™ng

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Start  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Xem giá» hÃ ng     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡
   â•±           â•²
  â•±  Giá» hÃ ng   â•²     Rá»—ng
 â—‡   cÃ³ SP?      â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â•²             â•±             â”‚
   â•²           â•±              â”‚
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡               â”‚
         â”‚ CÃ³                 â”‚
         â–¼                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ Nháº­p thÃ´ng tin   â”‚          â”‚
â”‚   giao hÃ ng      â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
         â”‚                    â”‚
         â–¼                    â”‚
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡               â”‚
   â•±           â•²              â”‚
  â•±  Validate   â•²   Invalid   â”‚
 â—‡   thÃ´ng tin   â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â•²             â•±             â”‚
   â•²           â•±              â”‚
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡               â”‚
         â”‚ Valid              â”‚
         â–¼                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ Chá»n phÆ°Æ¡ng thá»©c â”‚          â”‚
â”‚   thanh toÃ¡n     â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
         â”‚                    â”‚
         â–¼                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ Kiá»ƒm tra tá»“n kho â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
         â”‚                    â”‚
         â–¼                    â”‚
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡               â”‚
   â•±           â•²              â”‚
  â•±   Äá»§ hÃ ng   â•²   KhÃ´ng Ä‘á»§ â”‚
 â—‡     ?         â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â•²             â•±             â”‚
   â•²           â•±              â”‚
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡               â”‚
         â”‚ Äá»§                 â”‚
         â–¼                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ Reserve inventoryâ”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
         â”‚                    â”‚
         â–¼                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ Xá»­ lÃ½ thanh toÃ¡n â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
         â”‚                    â”‚
         â–¼                    â”‚
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡               â”‚
   â•±           â•²              â”‚
  â•±  Thanh toÃ¡n â•²    Lá»—i     â”‚
 â—‡   thÃ nh cÃ´ng? â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â•²             â•±             â”‚
   â•²           â•±              â”‚
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡               â”‚
         â”‚ OK                 â”‚
         â–¼                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ Táº¡o Ä‘Æ¡n hÃ ng     â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
         â”‚                    â”‚
         â–¼                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ Gá»­i email xÃ¡c    â”‚          â”‚
â”‚     nháº­n         â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
         â”‚                    â”‚
         â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Hiá»ƒn thá»‹ mÃ£ Ä‘Æ¡n  â”‚   â”‚ ThÃ´ng bÃ¡o lá»—iâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   End   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Biá»ƒu Ä‘á»“ tuáº§n tá»±

```
Client        Controller     OrderService    ProductRepo    PaymentSvc    OrderRepo      Database
  â”‚               â”‚               â”‚              â”‚              â”‚             â”‚              â”‚
  â”‚â”€â”€Checkoutâ”€â”€â”€â–¶â”‚               â”‚              â”‚              â”‚             â”‚              â”‚
  â”‚               â”‚               â”‚              â”‚              â”‚             â”‚              â”‚
  â”‚               â”‚â”€â”€getCart()â”€â”€â”€â–¶â”‚              â”‚              â”‚             â”‚              â”‚
  â”‚               â”‚â—€â”€â”€cartItemsâ”€â”€â”€â”‚              â”‚              â”‚             â”‚              â”‚
  â”‚               â”‚               â”‚              â”‚              â”‚             â”‚              â”‚
  â”‚               â”‚â”€â”€validateStockâ–¶             â”‚              â”‚             â”‚              â”‚
  â”‚               â”‚               â”‚â”€â”€checkStockâ”€â–¶â”‚              â”‚             â”‚              â”‚
  â”‚               â”‚               â”‚              â”‚â”€â”€SELECTâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚               â”‚               â”‚              â”‚   products                            â”‚
  â”‚               â”‚               â”‚              â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€stock levelsâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚               â”‚               â”‚â—€â”€â”€inStockâ”€â”€â”€â”€â”‚              â”‚             â”‚              â”‚
  â”‚               â”‚               â”‚              â”‚              â”‚             â”‚              â”‚
  â”‚â”€â”€PlaceOrderâ”€â”€â–¶â”‚              â”‚              â”‚              â”‚             â”‚              â”‚
  â”‚               â”‚â”€â”€createOrderâ”€â–¶â”‚              â”‚              â”‚             â”‚              â”‚
  â”‚               â”‚               â”‚              â”‚              â”‚             â”‚              â”‚
  â”‚               â”‚               â”‚â”€â”€reserveStockâ–¶             â”‚             â”‚              â”‚
  â”‚               â”‚               â”‚              â”‚â”€â”€UPDATEâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚               â”‚               â”‚              â”‚  quantity                             â”‚
  â”‚               â”‚               â”‚              â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€OKâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚               â”‚               â”‚â—€â”€â”€reservedâ”€â”€â”€â”‚              â”‚             â”‚              â”‚
  â”‚               â”‚               â”‚              â”‚              â”‚             â”‚              â”‚
  â”‚               â”‚               â”‚â”€â”€processPaymentâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚            â”‚              â”‚
  â”‚               â”‚               â”‚              â”‚              â”‚â”€â”€charge()â”€â–¶â”‚              â”‚
  â”‚               â”‚               â”‚              â”‚              â”‚â—€â”€â”€successâ”€â”€â”‚              â”‚
  â”‚               â”‚               â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€payment OKâ”€â”€â”€â”€â”€â”‚            â”‚              â”‚
  â”‚               â”‚               â”‚              â”‚              â”‚             â”‚              â”‚
  â”‚               â”‚               â”‚â”€â”€saveOrderâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚
  â”‚               â”‚               â”‚              â”‚              â”‚             â”‚â”€â”€INSERTâ”€â”€â”€â”€â–¶â”‚
  â”‚               â”‚               â”‚              â”‚              â”‚             â”‚   orders    â”‚
  â”‚               â”‚               â”‚              â”‚              â”‚             â”‚â—€â”€â”€order_idâ”€â”€â”‚
  â”‚               â”‚               â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€order createdâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚
  â”‚               â”‚               â”‚              â”‚              â”‚             â”‚              â”‚
  â”‚               â”‚               â”‚â”€â”€sendEmail()â”€â–¶             â”‚             â”‚              â”‚
  â”‚               â”‚               â”‚              â”‚              â”‚             â”‚              â”‚
  â”‚               â”‚â—€â”€â”€Order#12345â”€â”‚              â”‚              â”‚             â”‚              â”‚
  â”‚               â”‚               â”‚              â”‚              â”‚             â”‚              â”‚
  â”‚â—€â”€â”€Responseâ”€â”€â”€â”€â”‚              â”‚              â”‚              â”‚             â”‚              â”‚
  â”‚  (order info) â”‚               â”‚              â”‚              â”‚             â”‚              â”‚
```

### 2.3.4 Chá»©c nÄƒng 2: THEO DÃ•I ÄÆ N HÃ€NG

#### Thiáº¿t káº¿ giao diá»‡n

**Client Side - Order Tracking:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       THEO DÃ•I ÄÆ N HÃ€NG             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MÃ£ Ä‘Æ¡n: #ORD-2024-001234            â”‚
â”‚ NgÃ y Ä‘áº·t: 15/01/2024 10:30          â”‚
â”‚                                      â”‚
â”‚ TRáº NG THÃI ÄÆ N HÃ€NG                 â”‚
â”‚                                      â”‚
â”‚ [âœ“]â”€â”€[âœ“]â”€â”€[âœ“]â”€â”€[â—]â”€â”€[ ]â”€â”€[ ]       â”‚
â”‚  Äáº·t  XÃ¡c  ÄÃ³ng  Váº­n  Giao HoÃ n    â”‚
â”‚ hÃ ng  nháº­n  gÃ³i  chuyá»ƒn hÃ ng táº¥t    â”‚
â”‚                                      â”‚
â”‚ Tráº¡ng thÃ¡i hiá»‡n táº¡i: Äang váº­n chuyá»ƒnâ”‚
â”‚ Dá»± kiáº¿n giao: 18/01/2024            â”‚
â”‚                                      â”‚
â”‚ CHI TIáº¾T ÄÆ N HÃ€NG                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ 1. Sáº£n pháº©m A x2   1,000,000Ä‘ â”‚  â”‚
â”‚ â”‚ 2. Sáº£n pháº©m B x1     300,000Ä‘ â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚
â”‚ Äá»‹a chá»‰ giao: 123 ABC, Q1, TP.HCM   â”‚
â”‚ SÄT: 0901234567                     â”‚
â”‚                                      â”‚
â”‚ [Há»§y Ä‘Æ¡n]  [LiÃªn há»‡ há»— trá»£]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Server Side - Order Management:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          QUáº¢N LÃ ÄÆ N HÃ€NG                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Bá»™ lá»c: [â–¼Táº¥t cáº£] [â–¼HÃ´m nay] [TÃ¬m kiáº¿m___] â”‚
â”‚                                               â”‚
â”‚ â”Œâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚STTâ”‚ MÃ£ Ä‘Æ¡n   â”‚KhÃ¡ch hÃ ngâ”‚ Tráº¡ng thÃ¡i     â”‚â”‚
â”‚ â”œâ”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚ â”‚ 1 â”‚ORD-1234 â”‚ Nguyá»…n A â”‚ âšª Chá» xÃ¡c nháº­nâ”‚â”‚
â”‚ â”‚ 2 â”‚ORD-1235 â”‚ Tráº§n B   â”‚ ğŸŸ¡ Äang xá»­ lÃ½  â”‚â”‚
â”‚ â”‚ 3 â”‚ORD-1236 â”‚ LÃª C     â”‚ ğŸŸ¢ Äang giao   â”‚â”‚
â”‚ â”‚ 4 â”‚ORD-1237 â”‚ Pháº¡m D   â”‚ âœ… HoÃ n thÃ nh  â”‚â”‚
â”‚ â””â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                               â”‚
â”‚ [Export Excel] [In bÃ¡o cÃ¡o] [Cáº­p nháº­t lá»c]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Biá»ƒu Ä‘á»“ lá»›p vÃ  cÃ¡c biá»ƒu Ä‘á»“ khÃ¡c (tÆ°Æ¡ng tá»± cáº¥u trÃºc Ä‘Ã£ trÃ¬nh bÃ y á»Ÿ trÃªn)

---

# PHáº¦N 3: Tá»”NG Káº¾T

## 3.1 TÃ­ch há»£p cÃ¡c module

Há»‡ thá»‘ng Ä‘Æ°á»£c thiáº¿t káº¿ theo kiáº¿n trÃºc microservices vá»›i 3 module chÃ­nh:
- Module Quáº£n lÃ½ ngÆ°á»i dÃ¹ng (Trang): Xá»­ lÃ½ authentication, authorization
- Module Quáº£n lÃ½ sáº£n pháº©m (Trá»ng): Quáº£n lÃ½ catalog, inventory
- Module Quáº£n lÃ½ Ä‘Æ¡n hÃ ng (ThuÃ¢n): Xá»­ lÃ½ Ä‘áº·t hÃ ng, thanh toÃ¡n

CÃ¡c module giao tiáº¿p qua RESTful API vÃ  message queue Ä‘á»ƒ Ä‘áº£m báº£o loose coupling.

## 3.2 Káº¿ hoáº¡ch triá»ƒn khai

1. **Phase 1**: XÃ¢y dá»±ng core services vÃ  database
2. **Phase 2**: PhÃ¡t triá»ƒn APIs vÃ  business logic
3. **Phase 3**: XÃ¢y dá»±ng UI/UX cho client vÃ  admin
4. **Phase 4**: Testing vÃ  optimization
5. **Phase 5**: Deployment vÃ  monitoring

## 3.3 CÃ´ng nghá»‡ vÃ  tools

- Version Control: Git/GitHub
- Project Management: Jira/Trello
- CI/CD: Jenkins/GitLab CI
- Container: Docker/Kubernetes
- Monitoring: Prometheus/Grafana

---

**Káº¾T THÃšC BÃO CÃO**
